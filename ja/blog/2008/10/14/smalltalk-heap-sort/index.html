<!doctype html>
<html lang="ja">


<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Smalltalk でヒープソートを書いてみた - てっく煮ブログ</title>
	<!--[if lt IE 9]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link rel="stylesheet" href="/stylesheets/screen.css" type="text/css" />
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
	<meta property="og:title" content="Smalltalk でヒープソートを書いてみた"/>
	<meta property="og:url" content="http://tech.nitoyon.com/ja/blog/2008/10/14/smalltalk-heap-sort/"/>
	<meta property="og:type" content="article"/>
	<meta property="og:description" content="最近、アルゴリズムイントロダクション輪読会@京都 に参加している。前回のヒープソートの回では、id:secondlife さんが Ruby で ヒープソートサンプルコード を作っていたので、負けずに Smalltalk で作ってみた。Smalltalk は初めてなのであまり自信はないけど、やってみないことには始まらない。処理系は VisualWorks を使ってみた。クラス定義さっそく関数定義…したいんだけど、Smalltalk には関数はなくて全てメソッド。なので、まずはヒープを表現するクラスを定義する。OrderedCollection を継承して Heap クラスを作った。Orde..."/>
	<meta property="og:image" content="http://tech.nitoyon.com/apple-touch-icon-114x114.png"/>
	<meta property="og:site_name" content="てっく煮ブログ"/>
	<meta property="fb:admins" content="1297551349" />
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="nitoyon">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/ja/blog/index.xml" />
</head>
<body class="ja">
<header class="wrap page-header">
<div class="wrapped">
	<h1 id="logo">
		
		<a href="/ja/blog/" id="logo-blog-ja">てっく煮ブログ</a>
		
	</h1>
	<nav>
		<ul>
<li class="home"><a href="/ja/">HOME</a></li><li class="about"><a href="/ja/about/">ABOUT</a></li><li class="blog"><a href="/ja/blog/">BLOG(ja)</a></li><li class="blog-en"><a href="/en/blog/">BLOG(en)</a></li>
		</ul>
	</nav>
</div>
</header>
<div class="wrap">
<div class="wrapped">

<article>
<header>
<div class="post-date">2008年10月14日</div>

<div class="post-tags"><a href="/ja/blog/tags/algorithm/">アルゴリズム</a></div>

<h1>Smalltalk でヒープソートを書いてみた</h1>


<div class="share">
	<a href="http://b.hatena.ne.jp/entry/tech.nitoyon.com/entry/20081014/smalltalk_heap_sort" class="hatena-bookmark-button" data-hatena-bookmark-title="Smalltalk でヒープソートを書いてみた - てっく煮ブログ"  data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
	<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tech.nitoyon.com/ja/blog/2008/10/14/smalltalk-heap-sort/" data-lang="ja" data-size="horizontal" data-text="Smalltalk でヒープソートを書いてみた - てっく煮ブログ" data-related="nitoyon" data-dnt="true">Tweet</a>
	<div class="fb-like" data-href="http://tech.nitoyon.com/ja/blog/2008/10/14/smalltalk-heap-sort/" data-send="false" data-layout="button_count" data-width="90" data-show-faces="false"></div>
</div>

</header>

<div id="entry">
<div class="entry-body">
<section>
<p>最近、<a href="http://d.hatena.ne.jp/motemen/20080813/1218634304">アルゴリズムイントロダクション輪読会@京都</a> に参加している。前回のヒープソートの回では、<a href="http://d.hatena.ne.jp/secondlife/">id:secondlife</a> さんが Ruby で <a href="http://introductiontoalgorithms.g.hatena.ne.jp/keyword/0801006%e3%83%92%e3%83%bc%e3%83%97%e3%82%bd%e3%83%bc%e3%83%88%e3%82%b5%e3%83%b3%e3%83%97%e3%83%ab%e3%82%b3%e3%83%bc%e3%83%89">ヒープソートサンプルコード</a> を作っていたので、負けずに Smalltalk で作ってみた。</p>
<p>Smalltalk は初めてなのであまり自信はないけど、やってみないことには始まらない。処理系は VisualWorks を使ってみた。</p>
<h1>クラス定義</h1>
<p>さっそく関数定義…したいんだけど、Smalltalk には関数はなくて全てメソッド。</p>
<p>なので、まずはヒープを表現するクラスを定義する。OrderedCollection を継承して Heap クラスを作った。</p>
<pre class="ruby">OrderedCollection subclass: #Heap
    instanceVariableNames: 'heapSize'
    classVariableNames: ''
    poolDictionaries: ''
    category: nil.</pre>
<p>次にインスタンス作成時の処理を行う initialize メソッドを定義する。Smalltalk でのメソッド定義は基本的に GUI ベースで行うので、ちょっと無理やりなメソッド定義となっている。Ruby で class_eval してるような感じ。</p>
<pre class="ruby">Heap compile: 'initialize: anArray
    super addAll: anArray asOrderedCollection.
    heapSize := self size.'.</pre>
<p>Smalltalk のコレクションはインデックスが 1 から始まるので、特に工夫する必要はない。</p>
<h1>メソッド定義していく</h1>
<p><a href="http://www.amazon.co.jp/exec/obidos/ASIN/4764903342/nitoyoncom-22/ref=nosim">アルゴリズムイントロダクション 第1巻</a> に載ってる parent や left を定義した。</p>
<pre class="ruby">Heap compile: 'parent: anInteger
    ^ (anInteger / 2) truncated'.

Heap compile: 'left: anInteger
    ^ 2 * anInteger'.

Heap compile: 'right: anInteger
    ^ 2 * anInteger + 1'.

Heap compile: 'swap: i and: j
    | tmp |
    tmp := self at: i.
    self at: i put: (self at: j).
    self at: j put: tmp.'.</pre>
<p>ついでに配列の要素を入れ替える swap も定義しておいた。</p>
<h1>if に苦しむ</h1>
<p>同じように、教科書の MAX-HEAPIFY を定義。</p>
<pre class="ruby">Heap compile: 'maxHeapify: i
    | l r largest |
    l := self left: i.
    r := self right: i.
    (l &lt;= heapSize and: [(self at: l) &gt; (self at: i)])
        ifTrue:    [largest := l]
        ifFalse:  [largest := i].
    (r &lt;= heapSize and: [(self at: r) &gt; (self at: largest)])
        ifTrue:    [largest := r].
    (largest = i) not 
        ifTrue: [ self swap: largest and: i.
            self maxHeapify: largest.
        ].'.</pre>
<p>Smalltalk には if 文がないので、true や false の ifTrue～ifFalse メソッドを利用している。</p>
<p>教科書のサンプルでは、A &amp;&amp; B がショートサーキットなところ（A が false なら、B は評価されないところ）を利用していたんだけど、Smalltalk の A &amp; B は A も B も評価されてしまう。というのも、&amp; は true や false のメソッドとして実装されている。遅延評価もない以上、必ず B が評価されてしまうようだ。</p>
<p>仕方がないので、２つ目の条件をブロックで受け取る A and: Bblock を使ってみた。こうすれば、前が true のときのみ、B を評価してくれる。</p>
<h1>慣れてきた</h1>
<p>あとは同じようにえいや。</p>
<pre class="ruby">Heap compile: 'buildMaxHeap
    (heapSize / 2) truncated to: 1 by: -1 
        do: [:i | self maxHeapify: i.]'.

Heap compile: 'heapSort
    self buildMaxHeap.
    (self size) to: 2 by: -1 do: [:i |
        self swap: 1 and: i.
        heapSize := heapSize - 1.
        self maxHeapify: 1.
    ]'.</pre>
<p>数字 to: 数字 で範囲になって、ブロックで処理をするあたりが Ruby とそっくり。downto がなくて Ruby に負けた感じだけど、Ruby に負けず劣らず、教科書の疑似コードに近くなった気はしている。</p>
<p>最後に実行。</p>
<pre class="ruby">| aHeap |

aHeap := Heap new initialize: #(16 4 10 14 7 9 3 2 8 1).
aHeap heapSort.
Transcript show: aHeap printString.</pre>
<p>Ruby だと new した瞬間に initialize が呼ばれるんだけど、Smalltalk では new のあとに initialize をつけて明示的に呼ぶのがお約束になっているようだ。</p>
<h1>感想</h1>
<p>Ruby は Smalltalk の影響を強く受けてるみたいで、いろんなところで共通点が多い。</p>
<p>なので、Ruby のコードを移植するのは簡単かなーと思って試してみたんだけど、Smalltalk の独特の癖に翻弄されてすごく時間がかかってしまった。けど、慣れてくると面白い。もう少し、Smalltalk と戯れてみよう。</p>
<p>Ruby 好きな人は、Smalltalk を勉強してみると起源が辿れて面白いかもしれない。私はこの本を読んで Smalltalk を勉強した。著者の語り口が授業を受けてるみたいで面白かった。</p>
<div class="hatena-asin-detail">
  <a href="http://www.amazon.co.jp/Smalltalk%E3%81%A7%E5%AD%A6%E3%81%B6%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%8C%87%E5%90%91%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AE%E6%9C%AC%E8%B3%AA-%E9%9D%92%E6%9C%A8-%E6%B7%B3/dp/4822283623%3FSubscriptionId%3DAKIAJTLVJPAVA2KR4PJA%26tag%3Dnitoyoncom-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D4822283623"><img src="http://ecx.images-amazon.com/images/I/41w3JmwmXrL._SL160_.jpg" class="hatena-asin-detail-image" alt="Smalltalkで学ぶオブジェクト指向プログラミングの本質" title="Smalltalkで学ぶオブジェクト指向プログラミングの本質"></a>
  <div class="hatena-asin-detail-info">
    <p class="hatena-asin-detail-title"><a href="http://www.amazon.co.jp/Smalltalk%E3%81%A7%E5%AD%A6%E3%81%B6%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%8C%87%E5%90%91%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%81%AE%E6%9C%AC%E8%B3%AA-%E9%9D%92%E6%9C%A8-%E6%B7%B3/dp/4822283623%3FSubscriptionId%3DAKIAJTLVJPAVA2KR4PJA%26tag%3Dnitoyoncom-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D165953%26creativeASIN%3D4822283623">Smalltalkで学ぶオブジェクト指向プログラミングの本質</a></p>
    <ul>
      <li><span class="hatena-asin-detail-label">作者:</span> 青木 淳</li>
      <li><span class="hatena-asin-detail-label">出版社/メーカー:</span> 日経BP社</li>
      <li><span class="hatena-asin-detail-label">発売日:</span> 2008-07-24</li>
      <li><span class="hatena-asin-detail-label">メディア:</span> 単行本（ソフトカバー）</li>
      <li><a href="http://www.amazon.co.jp/review/product/4822283623%3FSubscriptionId%3DAKIAJTLVJPAVA2KR4PJA%26tag%3Dnitoyoncom-22%26linkCode%3Dxm2%26camp%3D2025%26creative%3D5143%26creativeASIN%3D4822283623">Amazon のレビューを見る</a></li>
    </ul>
  </div>
  <div class="hatena-asin-detail-foot"></div>
</div>
<p>ただ、後半のほとんどが自作フレームワークの使い方の解説になってるのが残念…。もうちょっとオブジェクト指向のなんたるか、や、MVC の具体例を見たかったものだ。</p>
<p>コードでクラスを定義する方法は、以下の２つのページを参考にした。</p>
<ul><li><a href="http://d.hatena.ne.jp/sumim/20080304/p1" title="最低限の Squeak Smalltalk 入門 - sumim’s Smalltalking-tosへ">最低限の Squeak Smalltalk 入門 - sumim’s Smalltalking-tos</a></li><li><a href="http://www.sra.co.jp/people/h-asaoka/study/TextbookAboutJun/19/index.html" title="Textbook about Jun for Smalltalk 19へ">Textbook about Jun for Smalltalk 19</a></li></ul>
</section>

</div>

<footer>

<div id="post-ad">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle my_adslot_1"
     style="display:inline-block"
     data-ad-client="ca-pub-5030829344952718"
     data-ad-slot="4154719447"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ins class="adsbygoogle my_adslot_2"
     style="display:inline-block"
     data-ad-client="ca-pub-5030829344952718"
     data-ad-slot="5631452649"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

</div>

<div class="share">

<div class="share">
	<a href="http://b.hatena.ne.jp/entry/tech.nitoyon.com/entry/20081014/smalltalk_heap_sort" class="hatena-bookmark-button" data-hatena-bookmark-title="Smalltalk でヒープソートを書いてみた - てっく煮ブログ"  data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
	<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tech.nitoyon.com/ja/blog/2008/10/14/smalltalk-heap-sort/" data-lang="ja" data-size="horizontal" data-text="Smalltalk でヒープソートを書いてみた - てっく煮ブログ" data-related="nitoyon" data-dnt="true">Tweet</a>
	<div class="fb-like" data-href="http://tech.nitoyon.com/ja/blog/2008/10/14/smalltalk-heap-sort/" data-send="false" data-layout="button_count" data-width="90" data-show-faces="false"></div>
</div>

</div>

<div class="entry-data">
<div class="post-date">2008年10月14日 <span class="edit-history"><a href="https://github.com/nitoyon/tech.nitoyon.com/commits/master/_posts/ja/2008-10-14-smalltalk-heap-sort.htn">編集履歴</a></span></div>

<div class="post-tags"><a href="/ja/blog/tags/algorithm/">アルゴリズム</a></div>
</div>



<div id="pager">
	
	<div class="previous">
		<a href="/ja/blog/2008/10/06/million3/" rel="previous"><b>&laquo;</b><span class="title">第３回 百万遍チャーの会</span></a>
	</div>
	
	
	<div class="next">
		<a href="/ja/blog/2008/10/15/xray-as3/" rel="next"><span class="title">&quot;XRay&quot; - ActionScript3 版の Firebug みたいなデバッグツール</span><b>&raquo;</b></a>
	</div>
	
</div>

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</footer>
</div><!--entry-->

</article>

</div>
</div>

<footer class="page-footer">
<h2>About</h2>
<div class="wrapped">
<div id="footer-right-column" class="column">
	<div id="profile">
		<h3>Profile</h3>

		<a href="/about.html" id="prof_pic"><img alt="Photo" src="/img/icon/pic.jpg"></a>
		<p>nitoyon (にとよん)</p>
		<p>京都のベンチャー会社勤務。プログラマ、たまに趣味でデザイン。</p>
		<p class="seemore"><a href="/ja/about/">詳細</a></p>
	</div>

	
	<div id="subscribe">
		<h3>Subscribe</h3>
		<ul>
			<li><a href="https://twitter.com/nitoyon" class="twitter-icon32">twitter: @nitoyon</a></li>
			<li><a href="https://www.facebook.com/TechNiBlogJa" class="facebook-icon32">Facebook ページ</a></li>
			<li><a href="/ja/blog/index.xml" class="rss-icon32">RSS</a></li>
		</ul>
	</div>
</div>

<div id="footer-left-column" class="column">
	<div id="recententries">
		<h3>Recent Entries</h3>
		<ul id="recententries_list">
			<li><img src="/images/loading.gif"><noscript>(JavaScript required)</noscript></li>
		</ul>
	</div>
</div>
</div><!--wrapped-->

<div class="wrapped">
	<div id="archive">
	<h3>Archive</h3>
	<ul id="archive_month_list">
		<li><img src="/images/loading.gif"><noscript>(JavaScript required)</noscript></li>
	</ul>
	</div>
</div><!-- wrapped -->

<div class="wrap copy">
&copy; nitoyon 2002-2014. All rights reserved.
</div>
</footer>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/ja/posts.js"></script>
<script src="/javascripts/techni.js"></script>
<div id="fb-root"></div>
</body>
</html>