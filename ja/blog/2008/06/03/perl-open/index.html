<!doctype html>
<html lang="ja">


<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Perl 2008年のファイルオープン - てっく煮ブログ</title>
	<link rel="stylesheet" href="/stylesheets/screen.css" type="text/css" />
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
	<meta property="og:title" content="Perl 2008年のファイルオープン"/>
	<meta property="og:url" content="http://tech.nitoyon.com/ja/blog/2008/06/03/perl-open/"/>
	<meta property="og:type" content="article"/>
	<meta property="og:description" content="第1回　Perlの文法の基本：ITpro という記事の はてブコメントを見ていたら、Perl なすごい人達が文句言ってた。 otsune 2006年のhyuki Catalyst記事を載せるのもアレなのに2003年の記事を載せるのは無しだろ……open IN, ...のあたりは有害情報なので全力で見逃せ TAKESAKO ちょｗ→出典：日経Linux 2003年7月号　125ページより miyagawa 2008年にこの記事はねーよ、と思ったら2003年の記事をいまさら再掲か。なんでわざわざ古い記事を新しいものかのように出して混乱させる？問題があるというソースコードはこんなの。open ..."/>
	<meta property="og:image" content="http://tech.nitoyon.com/apple-touch-icon-114x114.png"/>
	<meta property="og:site_name" content="てっく煮ブログ"/>
	<meta property="fb:admins" content="1297551349" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/ja/blog/index.xml" />
</head>
<body class="ja">
<header class="wrap page-header">
<div class="wrapped">
	<h1 id="logo">
		
		<a href="/ja/blog/" id="logo-blog-ja">てっく煮ブログ</a>
		
	</h1>
	<nav>
		<ul>
<li class="home"><a href="/ja/">HOME</a></li><li class="about"><a href="http://tech.nitoyon.com/about.html">ABOUT</a></li><li class="blog"><a href="/ja/blog/">BLOG(ja)</a></li><li class="blog-en"><a href="/en/blog/">BLOG(en)</a></li><li class="contact"><a href="/contact.html">CONTACT</a></li>
		</ul>
	</nav>
</div>
</header>
<div class="wrap">
<div class="wrapped">

<article>
<header>
<hgroup>
<h2>2008年06月03日</h2>
<h1>Perl 2008年のファイルオープン</h1>
</hgroup>

<div class="share">
	<a href="http://b.hatena.ne.jp/entry/tech.nitoyon.com/entry/20080603/perl_open" class="hatena-bookmark-button" data-hatena-bookmark-title="Perl 2008年のファイルオープン - てっく煮ブログ"  data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
	<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tech.nitoyon.com/ja/blog/2008/06/03/perl-open/" data-lang="ja" data-size="horizontal" data-text="Perl 2008年のファイルオープン - てっく煮ブログ" data-related="nitoyon" data-dnt="true">Tweet</a>
	<div class="fb-like" data-send="false" data-layout="button_count" data-width="90" data-show-faces="false"></div>
</div>

</header>

<div class="entry">
<div class="entry-body">
<section>
<p><a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20080528/304549/">第1回　Perlの文法の基本：ITpro</a> という記事の <a href="http://b.hatena.ne.jp/entry/http://itpro.nikkeibp.co.jp/article/COLUMN/20080528/304549/">はてブコメント</a>を見ていたら、Perl なすごい人達が文句言ってた。</p>
<blockquote><p><a href="/otsune/"><img src="http://www.hatena.ne.jp/users/ot/otsune/profile_s.gif" class="hatena-id-icon" alt="otsune" title="otsune" width="16" height="16" /></a> <a href="/otsune/20080602#bookmark-8806292">otsune</a>  <span class="comment">2006年のhyuki Catalyst記事を載せるのもアレなのに2003年の記事を載せるのは無しだろ……open IN, ...のあたりは有害情報なので全力で見逃せ</span><br></p><p><a href="/TAKESAKO/"><img src="http://www.hatena.ne.jp/users/TA/TAKESAKO/profile_s.gif" class="hatena-id-icon" alt="TAKESAKO" title="TAKESAKO" width="16" height="16" /></a> <a href="/TAKESAKO/20080602#bookmark-8806292">TAKESAKO</a> <span class="comment"> ちょｗ→出典：日経Linux 2003年7月号　125ページより</span><br></p><p><a href="/miyagawa/"><img src="http://www.hatena.ne.jp/users/mi/miyagawa/profile_s.gif" class="hatena-id-icon" alt="miyagawa" title="miyagawa" width="16" height="16" /></a> <a href="/miyagawa/20080602#bookmark-8806292">miyagawa</a>  <span class="comment"> 2008年にこの記事はねーよ、と思ったら2003年の記事をいまさら再掲か。なんでわざわざ古い記事を新しいものかのように出して混乱させる？</span></p></blockquote>
<p>問題があるというソースコードはこんなの。</p>
<div class="highlight"><pre><span class="nb">open</span> <span class="n">IN</span><span class="p">,</span> <span class="s">&#39;&lt;/etc/passwd&#39;</span><span class="p">;</span>
</pre>
</div>

<p>えー！　どこが問題あるのかさっぱり分からん！！！！！！</p>
<a name="seemore"></a>
<h1>調べてみた</h1>
<p>2008年流の Perl な書き方を調べるなら <a href="http://perl-users.jp/">perl-users.jp</a>。</p>
<p>早速見つけた。oldtype と modern の書き方が比較されている。</p>
<blockquote><p>open</p><ul><li>oldtype: open FH, "filename" or die $!;</li><li>modern: open my $fh, '<', 'filename' or die $!; または file('filename')->open('r') とか</li></ul><cite><a href="http://perl-users.jp/nowpast.html">Perl 5 今昔 - Perl-users.jp</a></cite></blockquote>
<h1>まず $! が分からない</h1>
<p>oldtype の $! すら理解できない自分…。Perl は特殊変数が多くて大変なんだよなぁ。しかも、検索エンジンで検索できないのが困り者。</p>
<p>こういうときは、<a href="http://perldoc.perl.org/perlvar.html">perlvar</a> を眺める。どうやら $! はエラーメッセージになるらしい。</p>
<blockquote><p>If used as a string, yields the corresponding system error string.</p></blockquote>
<p>どれどれ。</p>
<div class="highlight"><pre>&gt; perl -e <span class="s2">&quot;open FH, &#39;__not__found__&#39; or die $!&quot;</span>
No such file or directory at -e line 1.
</pre>
</div>

<p>おー、確かに。</p>
<p>数値リテラルだとエラーコードになるらしい。どれどれ...</p>
<div class="highlight"><pre>&gt; perl -e <span class="s2">&quot;open FH, &#39;__not__found__&#39; or print int($!)&quot;</span>
2
</pre>
</div>

<p>ほんとだ。</p>
<h1>MODE を分ける</h1>
<p>それでは、modern その１のコードを見てみる。</p>
<div class="highlight"><pre><span class="nb">open</span> <span class="k">my</span> <span class="nv">$fh</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;filename&#39;</span> <span class="ow">or</span> <span class="nb">die</span> <span class="vg">$!</span><span class="p">;</span>
</pre>
</div>

<p>謎だ。</p>
<p>困ってても仕方がないので、perldoc の <a href="http://perldoc.perl.org/functions/open.html">open</a> を見てみた。いくつもの書き方があるようだ。</p>
<pre>open FILEHANDLE,EXPR 
<strong>open FILEHANDLE,MODE,EXPR</strong>
open FILEHANDLE,MODE,EXPR,LIST 
open FILEHANDLE,MODE,REFERENCE 
open FILEHANDLE </pre>
<p>なるほど。今回は２番目の形になってる。MODE を分離して書けるのはセキュリティ的にも素敵だ。これは明日からでも使いたい感じ。</p>
<br />
<h1>my $fh の謎</h1>
<p>問題は my $fh。なんだこの書き方は。</p>
<p>open の説明をみても良く分からなかったので、<a href="http://perldoc.perl.org/perlopentut.html">perlopentut</a> を見てみた。</p>
<p>そしたら、<a href="http://perldoc.perl.org/perlopentut.html#Indirect-Filehandles">Indirect Filehandles</a> にズバリそのものの記述が（日本語は私が訳したもの）。</p>
<blockquote><p>open の第一引数はファイルハンドルのリファレンスを指定することもできます。Perl 5.6 では、第一引数が初期化されていない場合、Perl はファイルハンドルを自動的に作成し、第一引数にリファレンスを代入します。</p><blockquote><p>open's first argument can be a reference to a filehandle. As of perl 5.6.0, if the argument is uninitialized, Perl will automatically create a filehandle and put a reference to it in the first argument</p></blockquote></blockquote>
<p>なるほど。初期化されてない変数を渡せるわけね。</p>
<p>しかし、メリットがいまいち分からん。続きを読む（同じく、日本語は私が勝手に訳したもの）。</p>
<blockquote><p>Indrect filehandle を使うと、名前空間の扱いが簡単になります。ファイルハンドルはパッケージ空間に対して global なので、例えば２つのサブルーチンで INFILE を開くとクラッシュしてしまいます。indirect filehandle を利用して my $infile を開いた場合にはクラッシュする心配はありませんし、それ以後に名前の衝突が発生する恐れもありません。</p><blockquote><p>Indirect filehandles make namespace management easier. Since filehandles are global to the current package, two subroutines trying to open INFILE will clash. With two functions opening indirect filehandles like my $infile , there's no clash and no need to worry about future conflicts.</p></blockquote></blockquote>
<p>なるほど。これは安心。</p>
<p>open IN, ... 形式がグローバル変数で、open my $in, ... がローカル変数、というイメージ。</p>
<p>読んだり閉じたりするには次のようにする。</p>
<div class="highlight"><pre><span class="k">print</span> <span class="sr">&lt;$fh&gt;</span><span class="p">;</span>
<span class="nb">close</span> <span class="nv">$fh</span><span class="p">;</span>
</pre>
</div>

<p>Perl 5.6 以降限定だけど、これも明日から使えそうなテクニックだ。</p>
<h1>modern その２</h1>
<p>modern その２はお手上げ。</p>
<div class="highlight"><pre><span class="n">file</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
</pre>
</div>

<p>file 関数ってなんだ？？　なんかのモジュール？？</p>
<p>(追記) コメント欄でkzysさんに教えてもらいました。Path::Class モジュールのようです（<a href="http://search.cpan.org/dist/Path-Class/lib/Path/Class.pm">Path::Class</a>）。ありがとうございます。ファイルやディレクトリをたどるのが簡単になりそうですね。</p>
<h1>まとめ</h1>
<ul><li>Perl は奥が深い。難しい。</li><li>ハブサイトは初心者にとってありがたい。</li></ul>
<p>(追記) 弾さんも添削してた。ありがたや。参考になります。</p>
<ul><li><a href="http://blog.livedoor.jp/dankogai/archives/51060112.html">404 Blog Not Found:perl -　勝手に添削 - Perl入門#1@ITPro</a></li></ul>
</section>

</div>

<div class="bottom-share">
<div class="share">
	<a href="http://b.hatena.ne.jp/entry/tech.nitoyon.com/entry/20080603/perl_open" class="hatena-bookmark-button" data-hatena-bookmark-title="Perl 2008年のファイルオープン - てっく煮ブログ"  data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
	<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tech.nitoyon.com/ja/blog/2008/06/03/perl-open/" data-lang="ja" data-size="horizontal" data-text="Perl 2008年のファイルオープン - てっく煮ブログ" data-related="nitoyon" data-dnt="true">Tweet</a>
	<div class="fb-like" data-send="false" data-layout="button_count" data-width="90" data-show-faces="false"></div>
</div>

</div>

<div class="post-ad">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-5030829344952718";
/* tech.nitoyon.com footer */
google_ad_slot = "9965361520";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

<div id="pager-bottom">
	
		&laquo;&nbsp;<a href="/ja/blog/2008/06/02/jsdokan/" rel="previous">JSDokan で JSON をファイルシステムに</a>
	

	|

	
		<a href="/ja/blog/2008/06/05/csharp-jscriptcodeprovider/" rel="next">C#の JScriptCodeProvider で JScript.NET と仲良くする&nbsp;&raquo;</a>
	
</div>

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div><!--entry-->

</article>

</div>
</div>

<footer class="page-footer">
<h2>About</h2>
<div class="wrapped">
	<div id="profile" class="column">
		<h3>Profile</h3>

		<a href="/about.html" id="prof_pic"><img alt="Photo" src="/img/icon/pic.jpg"></a>
		<p>nitoyon (にとよん)</p>
		<p>京都のベンチャー会社勤務。プログラマ、たまに趣味でデザイン。twitter は @nitoyon。</p>
		<p class="seemore"><a href="/about.html">詳細</a></p>
	</div>

	<div id="recententries" class="column">
		<h3>Recent Entries</h3>
		<ul id="recententries_list">
			<li><img src="/images/loading.gif"><noscript>(JavaScript required)</noscript></li>
		</ul>
	</div>
</div>
</div><!--wrapped-->

<div class="wrapped">
	<h3>Archive</h3>
	<ul id="archive_month_list">
		<li><img src="/images/loading.gif"><noscript>(JavaScript required)</noscript></li>
	</ul>
</div><!-- wrapped -->

<div class="wrap copy">
&copy; nitoyon 2002-2012. All rights reserved.
</div>
</footer>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/ja/posts.js"></script>
<script src="/javascripts/techni.js"></script>
<div id="fb-root"></div>
</body>
</html>