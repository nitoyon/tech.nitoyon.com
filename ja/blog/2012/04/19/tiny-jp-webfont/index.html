<!doctype html>
<html lang="ja">


<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>文字を制限した軽量な日本語 Web フォントを作成する方法 - てっく煮ブログ</title>
	<!--[if lt IE 9]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link rel="stylesheet" href="/stylesheets/screen.css" type="text/css" />
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
	<meta property="og:title" content="文字を制限した軽量な日本語 Web フォントを作成する方法"/>
	<meta property="og:url" content="http://tech.nitoyon.com/ja/blog/2012/04/19/tiny-jp-webfont/"/>
	<meta property="og:type" content="article"/>
	<meta property="og:description" content="最近、Web フォントをつかってかっこいい表現をしているサイトも増えてきました。ただ、残念ながら 日本語で Web フォントを使うのは厳しいのが現実です。というのも、日本語には英数字・ひらがな・カタカナ・漢字・記号・・・など必要になる文字数が多すぎるため、フルスペックの日本語の Web フォントはファイルサイズがすごいことになりそうです。そこで、「利用したい文字だけを含んだ Web フォントをその都度作ればいいんじゃね？」ということを考えてみました。アイデア自体は珍しいものではなく、例えば デコもじ というサービスは同じようなことをやってくれるようです（ただし、無料では「書体 1 つまで..."/>
	<meta property="og:image" content="http://tech.nitoyon.com/apple-touch-icon-114x114.png"/>
	<meta property="og:site_name" content="てっく煮ブログ"/>
	<meta property="fb:admins" content="1297551349" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=0">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/ja/blog/index.xml" />
</head>
<body class="ja">
<header class="wrap page-header">
<div class="wrapped">
	<h1 id="logo">
		
		<a href="/ja/blog/" id="logo-blog-ja">てっく煮ブログ</a>
		
	</h1>
	<nav>
		<ul>
<li class="home"><a href="/ja/">HOME</a></li><li class="about"><a href="http://tech.nitoyon.com/about.html">ABOUT</a></li><li class="blog"><a href="/ja/blog/">BLOG(ja)</a></li><li class="blog-en"><a href="/en/blog/">BLOG(en)</a></li><li class="contact"><a href="/contact.html">CONTACT</a></li>
		</ul>
	</nav>
</div>
</header>
<div class="wrap">
<div class="wrapped">

<article>
<header>
<hgroup>
<h2>2012年04月19日</h2>
<h1>文字を制限した軽量な日本語 Web フォントを作成する方法</h1>
</hgroup>

<div class="share">
	<a href="http://b.hatena.ne.jp/entry/tech.nitoyon.com/entry/20120419/tiny_jp_webfont" class="hatena-bookmark-button" data-hatena-bookmark-title="文字を制限した軽量な日本語 Web フォントを作成する方法 - てっく煮ブログ"  data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
	<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tech.nitoyon.com/ja/blog/2012/04/19/tiny-jp-webfont/" data-lang="ja" data-size="horizontal" data-text="文字を制限した軽量な日本語 Web フォントを作成する方法 - てっく煮ブログ" data-related="nitoyon" data-dnt="true">Tweet</a>
	<div class="fb-like" data-send="false" data-layout="button_count" data-width="90" data-show-faces="false"></div>
</div>

</header>

<div class="entry">
<div class="entry-body">
<section>
<p>最近、Web フォントをつかってかっこいい表現をしているサイトも増えてきました。ただ、残念ながら 日本語で Web フォントを使うのは厳しいのが現実です。</p>
<p>というのも、日本語には英数字・ひらがな・カタカナ・漢字・記号・・・など必要になる文字数が多すぎるため、フルスペックの日本語の Web フォントはファイルサイズがすごいことになりそうです。</p>
<p>そこで、「<strong>利用したい文字だけを含んだ Web フォントをその都度作ればいいんじゃね？</strong>」ということを考えてみました。アイデア自体は珍しいものではなく、例えば <a href="http://decomoji.jp/">デコもじ</a> というサービスは同じようなことをやってくれるようです（ただし、無料では「書体 1 つまで」「5 文字まで」など機能制限が大きい）。</p>
<p>(追記) このような軽量フォントを作成することを<strong>「サブセット化」</strong>というようです。</p>
<h1>手始めに日本語 Web フォントを作ってみる</h1>
<p>まずは簡単に日本語 Web フォントを作る方法を紹介しておきます。</p>
<p>無料で公開されているフォントの中にも、フォントファイルの改変を禁止しているものが意外と多いので注意が必要です。今回は、武蔵システムが公開している <a href="http://musashi.or.tv/kouzansousho.htm">衡山毛筆フォント草書</a> を選びました。無料で、改編も自由とのことで遠慮なく活用させてもらいます。</p>
<p>(追記) Web フォントとして利用できるフォント一覧が <a href="http://www.yomotsu.net/wp/?p=565">WebFonts として利用できるフリーの和文フォント | ヨモツネット</a> にまとまっていました。</p>
<p>Web フォント化する方法ですが、同じく武蔵システムが公開している <a href="http://musashi.or.tv/woffconv.htm">WOFF コンバーター</a> を使ってみました。実行してみるとサンプルの HTML も吐いてくれます。</p>
<p>ブラウザー上で毛筆フォントを表示できました！</p>
<center><a href="http://f.hatena.ne.jp/nitoyon/20120419013354"><img src="http://f.hatena.ne.jp/images/fotolife/n/nitoyon/20120419/20120419013354.png"></a></center>
<a name="seemore"></a>
<p>気になるファイルサイズは次のようになっていました。</p>
<pre class="">衡山毛筆フォント草書.ttf: 5,732 KB
                 ↓
衡山毛筆フォント草書.woff: 3.697 KB</pre>
<p>うーん、3 MB 以上の Web フォントを使うのは現実的ではありませんね。</p>
<h1>不要な文字を取り除いてみる</h1>
<p>3 MB は嫌すぎるので、使いたい文字のみを含んだ Web フォントを作ってみましょう。</p>
<p>今回は</p>
<blockquote><p>日本語フォントをWebFontに変換すると数MBになってしまうので日本語は難しいと思っていました。</p></blockquote>
<p>という文を表示するためだけの Web フォントを作ってみます。</p>
<p>フォントの編集ソフトといえば FontForge や TTEdit などが有名なようですが、手作業でやるのは耐えられません。FontForge はスクリプト機能もあるようですが、Windows では環境の準備が大変なので敬遠しました。</p>
<p>そこで、<a href="http://d.hatena.ne.jp/project_the_tower2/20101106/1289060546">Webフォント変換サービスを作ろう その1（ ´_ゝ`） - Webと文字</a> で紹介されていた Python のライブラリ <a href="http://sourceforge.net/projects/fonttools/files/">TTX/FontTools</a> を使ってみました。手順とソースコードは最後に紹介します。</p>
<p>変換したところ、こんなフォントができあがりました。</p>
<center><a href="http://f.hatena.ne.jp/nitoyon/20120419013355"><img src="http://f.hatena.ne.jp/images/fotolife/n/nitoyon/20120419/20120419013355.png"></a></center>
<p>5.7 MB もあった ttf ファイルが  <strong>214 KB</strong> になりました。「Windows でコンピューターの世界が広がります。」が歯抜けになっていることからも、必要最低限の文字しか含まれていないことが分かります。</p>
<p>この ttf ファイルを WOFF に変換すると次のようになりました。</p>
<pre class="">衡山毛筆フォント草書(改).ttf: 214 KB
                 ↓
衡山毛筆フォント草書(改).woff: 67 KB</pre>
<p>67 KB なら画像ファイル 1 枚程度のサイズです。</p>
<p>画像で埋め込むよりも SEO 効果は高いですし、文字のコピペもできます。タイトル字に画像を使うぐらいなら、こっちのほうがいいかもしれません。</p>
<h1>もっとサイズを小さくしたい！</h1>
<p>今回のスクリプトでは<strong>「未使用の文字のベクターデータを空にする」</strong>という処理のみを行っています。</p>
<p>フォントファイルには、その他にも</p>
<ul><li>バイト列をどの文字に対応付けるか (文字コードごとに…)</li><li>縦書、合字、カーニング、異体字…etc</li></ul>
<p>の情報が残っています。このあたりを整理できれば、まだまだファイルサイズは小さくできます。</p>
<p>空にしたベクターデータについても、「何も描画しない」というデータが残ってしまっています。これを削除できればもっとサイズを抑えられるはずです。</p>
<p>しかし、いろいろ試してみたのですが、各テーブルが複雑に絡まりあっていて、一部を下手に削除すると保存時にエラーがでたり、表示できないフォントファイルができあがったりと、かなり難易度高かったです。</p>
<p>かといって、<a href="http://www.microsoft.com/typography/otspec/">OpenFont の仕様書</a> を最初から読む気にもなりません。フォントの世界は難しいです…。</p>
<p>何かいいツールやライブラリがあれば教えてください。(追記)<strong><a href="http://www.fontsquirrel.com/fontface/generator">Font Squirrel | Create Your Own @font-face Kits</a> を使えば日本語のサブセット化にも対応してくれるようです。ためしに 1 文字のフォントを作ったら数 KB になりました。</strong></p>
<h1>スクリプトの使い方</h1>
<p>では最後にスクリプトを公開します。</p>
<p>動作には Python 2.X、が必要です。</p>
<blockquote><ol><li>Python 2.X の実行環境を用意します。</li><li><a href="http://numpy.scipy.org/">Numpy</a> をダウンロードして、インストールします。</li><li><a href="http://sourceforge.net/projects/fonttools/files/">fonttools-2.3.tar.gz</a> をダウンロードして、展開します。</li></ol><cite><a href="http://d.hatena.ne.jp/project_the_tower2/20101106/1289060546">Webフォント変換サービスを作ろう　その１（　´_ゝ`） - Webと文字</a></cite></blockquote>
<p>実行するには次のようにします。</p>
<div class="highlight"><pre>python compact.py FontName.ttf &lt; test.txt
</pre>
</div>

<ul><li>第一引数にサイズを小さくするフォントを指定する</li><li>取り出す文字を含んだ文章を UTF-8 で保存して、標準入力から渡す</li><li>変換に成功すると <code>converted-FontName.ttf</code> が出力される</li><li>出力フォントに半角の数字や記号が含まれないバグあり (グリフ名が <code>zero</code>、<code>plus</code> などになっていて機械的変換できなかった。本気でやるなら <code>cmap</code> を見るべきなのだが面倒だった。)</li></ul>
<p>ソースコードは以下の通りです。</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">fontTools.ttLib.tables</span>
<span class="kn">import</span> <span class="nn">fontTools.ttLib</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;font file not specified&quot;</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;file not found: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">s</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">readlines</span><span class="p">())</span>
<span class="n">s</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>

<span class="n">chars</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">:</span>
        <span class="n">chars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;uni</span><span class="si">%04X</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">));</span>
<span class="n">chars</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;.notdef&#39;</span><span class="p">)</span>

<span class="n">tt</span> <span class="o">=</span> <span class="n">fontTools</span><span class="o">.</span><span class="n">ttLib</span><span class="o">.</span><span class="n">TTFont</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="n">tt</span><span class="p">[</span><span class="s">&#39;glyf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">glyphs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">chars</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;skipping </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">g</span>
        <span class="k">continue</span>
    <span class="n">tt</span><span class="p">[</span><span class="s">&#39;glyf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">glyphs</span><span class="p">[</span><span class="n">g</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontTools</span><span class="o">.</span><span class="n">ttLib</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">_g_l_y_f</span><span class="o">.</span><span class="n">Glyph</span><span class="p">()</span>

<span class="n">output_path</span> <span class="o">=</span> <span class="s">&quot;converted-</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span>
<span class="n">tt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">output_path</span><span class="p">)</span>
<span class="k">print</span> <span class="s">&quot;wrote </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">output_path</span>
</pre>
</div>

</section>

</div>

<div class="bottom-share">
<div class="share">
	<a href="http://b.hatena.ne.jp/entry/tech.nitoyon.com/entry/20120419/tiny_jp_webfont" class="hatena-bookmark-button" data-hatena-bookmark-title="文字を制限した軽量な日本語 Web フォントを作成する方法 - てっく煮ブログ"  data-hatena-bookmark-layout="standard" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
	<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tech.nitoyon.com/ja/blog/2012/04/19/tiny-jp-webfont/" data-lang="ja" data-size="horizontal" data-text="文字を制限した軽量な日本語 Web フォントを作成する方法 - てっく煮ブログ" data-related="nitoyon" data-dnt="true">Tweet</a>
	<div class="fb-like" data-send="false" data-layout="button_count" data-width="90" data-show-faces="false"></div>
</div>

</div>

<div class="post-ad">
<script type="text/javascript"><!--
google_ad_client = "ca-pub-5030829344952718";
/* tech.nitoyon.com footer */
google_ad_slot = "9965361520";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</div>

<div id="pager-bottom">
	
		&laquo;&nbsp;<a href="/ja/blog/2012/04/17/git-bash-ime/" rel="previous">msysGit 1.7.10 の Git Bash に日本語が入力できない件について少し調べた</a>
	

	|

	
		<a href="/ja/blog/2012/04/20/uncopyable/" rel="next">絶対にコピペできない文章を作ったったwwww&nbsp;&raquo;</a>
	
</div>

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


</div><!--entry-->

</article>

</div>
</div>

<footer class="page-footer">
<h2>About</h2>
<div class="wrapped">
	<div id="profile" class="column">
		<h3>Profile</h3>

		<a href="/about.html" id="prof_pic"><img alt="Photo" src="/img/icon/pic.jpg"></a>
		<p>nitoyon (にとよん)</p>
		<p>京都のベンチャー会社勤務。プログラマ、たまに趣味でデザイン。twitter は @nitoyon。</p>
		<p class="seemore"><a href="/about.html">詳細</a></p>
	</div>

	<div id="recententries" class="column">
		<h3>Recent Entries</h3>
		<ul id="recententries_list">
			<li><img src="/images/loading.gif"><noscript>(JavaScript required)</noscript></li>
		</ul>
	</div>
</div>
</div><!--wrapped-->

<div class="wrapped">
	<h3>Archive</h3>
	<ul id="archive_month_list">
		<li><img src="/images/loading.gif"><noscript>(JavaScript required)</noscript></li>
	</ul>
</div><!-- wrapped -->

<div class="wrap copy">
&copy; nitoyon 2002-2012. All rights reserved.
</div>
</footer>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/ja/posts.js"></script>
<script src="/javascripts/techni.js"></script>
<div id="fb-root"></div>
</body>
</html>