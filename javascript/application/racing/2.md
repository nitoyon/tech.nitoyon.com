---
layout: post
title: Google Earth でもドライビング！
date: 2006-09-21 00:00:00
lang: ja
alternate:
  lang: en_US
  url: /javascript/application/racing/2_en.html
---
[Google Map でレーシング](./1/)はおかげさまで多くの方に好評でした。2D の平面がファミコン世代の心をくすぐったのでしょう。

しかし、人間の欲は果てしないもの。やはり 3D 空間でドライビングしたいですよね！


デモ
====

百聞は一見にしかず。<a href="http://www.youtube.com/watch?v=iMB5gzUtiM4">こちらの動画</a>をご覧ください。


遊び方
======

Google Earth の最新版（4.0.2080β 以降）がインストールされている必要があります。4.0.2080βは、2006年9月14日に公開された日本語や建物の 3D 表示に対応したバージョンです。バージョン番号を確認するには、メニューから「ヘルプ」→「Google Earth について」で確認できます。確認後、一旦、Google Earth を終了させてください。

Google Earth Plus や Pro での動作は確認していませんが動くと思います。残念ながら Mac では動きません。Windows 限定です。

1. [drive_earth.hta](2/drive_earth.hta) をダウンロードし、実行します。アンチウイルスソフトによっては警告を表示するかもしれませんが、無視して実行してください。（セキュリティーが怖い人は実行前にソースを読んで安心してください。このアプリケーションはファイル作成、レジストリ書き込みなどは一切行いません）

2. Google Earth が起動し、初期化が終了すると河口湖が表示されます。

3. 先ほど実行した *Drive on Google Earth と書いてあるアプリケーションを最前面に持ってきます*。

4. Z キーでアクセル、左右キーがハンドルです。富士山に登るもよし、実家周辺を走るもよし、好きに楽しんでください。

   利用できるキーは次のとおりです。

   キー       |動作
   -----------|----------------
   Right, Left|ハンドル
   Z          |アクセル
   X          |ブレーキ
   C          |バック
   Up, Down   |カメラの倍率調整
   A, S       |カメラの角度調整


要チェック ポイント
===================

* 遠くの場所に行きたいときは、カーソルキーの上で縮小して移動すると便利です。近くに到着してから下キーで好きな近さまで拡大してください。
* レイヤの「地形」はチェックしましょう。富士山登山が楽しくなります。グランドキャニオン下りもお勧めです。
* 日本国内を旅する場合は、「建物の 3D 表示」をチェックすることをお勧めします。街中を実際にドライブしてる感覚を味わえます。首都高で建物をすり抜けながらのドライブは格別です。
* ドライブ中は、Google Earth で検索を行っての移動や、画面のドラッグは行えません。一旦、drive_earth.hta を終了して希望の場所に移動した後、再度 drive_earth.hta を起動すれば、表示されていた場所からドライブを開始できます。


技術的なアレコレ
================

* Google Earth 自体は API を公開していませんが、Google Earth がインストール時に登録する COM インターフェース経由で操ってます。この COM インターフェースは <s>Google からアナウンスはされていないため</s> 2006年9月26日に <a href="http://earth.google.com/comapi/">http://earth.google.com/comapi/</a> にてこっそり公開されました。将来的に変更される可能性はありますが、いじって遊ぶには最適です。
* このアプリケーション自体は <a href="http://www.microsoft.com/japan/msdn/workshop/author/hta/overview/htaoverview.asp">HTA</a> で作成しています。ブラウザ上で動かせなかったのは、セキュリティー上の制限のためです。バイナリではなく HTA を利用したのは、こっちのほうがソースを読みやすいでしょう、ということで。
* 位置計算は方角に基づいて行っているので、北極や南極近くでは極に吸い込まれてしまいます。いいアルゴリズムをご存知の方がいらっしゃいましたら教えてください。球面三角法でやろうとしかけたのですが、うまくいきませんでした...
* ネットワークで他人も見えたら楽しいでしょうね。KML は HTTP 経由で動的アップデートすることができるので、多少がんばれば実装できそうです。
