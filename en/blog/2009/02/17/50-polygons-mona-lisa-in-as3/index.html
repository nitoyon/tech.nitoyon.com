<!doctype html>
<html lang="en">


<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>50 polygons Mona Lisa in AS3 - TECH-NI Blog</title>
	<!--[if lt IE 9]>
	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link rel="stylesheet" href="/stylesheets/screen.css" type="text/css" />
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
	<meta property="og:title" content="50 polygons Mona Lisa in AS3"/>
	<meta property="og:url" content="http://tech.nitoyon.com/en/blog/2009/02/17/50-polygons-mona-lisa-in-as3/"/>
	<meta property="og:type" content="article"/>
	<meta property="og:description" content="I ported Image evolution to ActionScript 3. We start from random 50 polygons that are invisible. In each optimization stepwe randomly modify one parameter (like color components or polygon vertices)and check whether such new variant looks more like the original..."/>
	<meta property="og:image" content="http://tech.nitoyon.com/apple-touch-icon-114x114.png"/>
	<meta property="og:site_name" content="TECH-NI Blog"/>
	<meta property="fb:admins" content="1297551349" />
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="nitoyon">
	<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="/en/blog/index.xml" />
</head>
<body class="en">
<header class="wrap page-header">
<div class="wrapped">
	<h1 id="logo">
		
		<a href="/en/blog/" id="logo-blog-en">TECH-NI Blog</a>
		
	</h1>
	<nav>
		<ul>
<li class="home"><a href="/en/">HOME</a></li><li class="about"><a href="/en/about/">ABOUT</a></li><li class="blog"><a href="/ja/blog/">BLOG(ja)</a></li><li class="blog-en"><a href="/en/blog/">BLOG(en)</a></li>
		</ul>
	</nav>
</div>
</header>
<div class="wrap">
<div class="wrapped">

<article>
<header>
<div class="post-date">17 Feb 2009</div>

<div class="post-tags"><a href="/en/blog/tags/actionscript/">ActionScript</a></div>

<h1>50 polygons Mona Lisa in AS3</h1>


<div class="share">
	
	<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tech.nitoyon.com/en/blog/2009/02/17/50-polygons-mona-lisa-in-as3/" data-lang="en" data-size="horizontal" data-text="50 polygons Mona Lisa in AS3 - TECH-NI Blog" data-related="nitoyon" data-dnt="true">Tweet</a>
	<div class="fb-like" data-href="http://tech.nitoyon.com/en/blog/2009/02/17/50-polygons-mona-lisa-in-as3/" data-send="false" data-layout="button_count" data-width="90" data-show-faces="false"></div>
</div>

</header>

<div id="entry">
<div class="entry-body">

<p>I ported <a href="http://alteredqualia.com/visualization/evolve/">Image evolution</a> to ActionScript 3. </p>

<blockquote>
<p>We start from random 50 polygons that are invisible. In each optimization step
we randomly modify one parameter (like color components or polygon vertices)
and check whether such new variant looks more like the original image.
If it is, we keep it, and continue to mutate this one instead.</p>
</blockquote>

<p>In my computer, the result was as follows.</p>

<p><center><img src="http://f.hatena.ne.jp/images/fotolife/n/nitoyon/20090217/20090217014358.jpg" width="450" height="378"></center></p>

<p>It&#39;s waste of CPU.., but very interesting.</p>

<p>Published SWF (CAUSION: TOO HEAVY CPU 60%~)</p>

<p><center><iframe src="/misc/embed_flash.html?url=%2Fmisc%2Fswf%2FMonalisaEvolve.swf&amp;bgcolor=%23ffffff" width="450" height="420" class="flash"></iframe></center></p>

<p>Because this program uses <code>BitmapData.compare()</code> to improve performance, it is about 10 times faster than the <a href="http://alteredqualia.com/visualization/evolve/">JavaScript version</a>. The original <a href="http://rogeralsing.com/2008/12/11/genetic-programming-mona-lisa-source-code-and-binaries/">C# version</a> is about 3 times faster than mine.</p>

<p>Here is the code: (189lines)</p>

<figure class="highlight"><pre><code class="language-actionscript" data-lang="actionscript"><span class="kr">package</span><span class="p">{</span>
<span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="o">*;</span>
<span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">text</span><span class="p">.</span><span class="o">*;</span>
<span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">geom</span><span class="p">.</span><span class="o">*;</span>
<span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">filters</span><span class="p">.</span><span class="nx">ColorMatrixFilter</span><span class="o">;</span>
<span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">setInterval</span><span class="o">;</span>

<span class="p">[</span><span class="nx">SWF</span><span class="p">(</span><span class="nx">backgroundColor</span><span class="o">=</span><span class="s2">"#eeeeee"</span><span class="p">)]</span>
<span class="kr">public</span> <span class="kr">class</span> <span class="nx">Evolve</span> <span class="kr">extends</span> <span class="nx">Sprite</span><span class="p">{</span>
    <span class="p">[</span><span class="nx">Embed</span><span class="p">(</span><span class="nx">source</span><span class="o">=</span><span class="s1">'mona_lisa_crop.jpg'</span><span class="p">)]</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">MonaLisa</span><span class="o">:</span><span class="nb">Class</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">imgWidth</span><span class="o">:</span><span class="nx">int</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">imgHeight</span><span class="o">:</span><span class="nx">int</span><span class="o">;</span>

    <span class="kr">private</span> <span class="kr">const</span> <span class="nx">POLYGONS</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">polygons</span><span class="o">:</span><span class="nx">Array</span> <span class="o">=</span> <span class="p">[]</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">mutating</span><span class="o">:</span><span class="nx">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">monotoneFilter</span><span class="o">:</span><span class="nx">ColorMatrixFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ColorMatrixFilter</span><span class="p">([</span>
            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
            <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
                <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span> <span class="p">])</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">pt0</span><span class="o">:</span><span class="nx">Point</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">rect</span><span class="o">:</span><span class="nx">Rectangle</span><span class="o">;</span>

    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">bestBmd</span><span class="o">:</span><span class="nx">BitmapData</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">testBmd</span><span class="o">:</span><span class="nx">BitmapData</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">inputBmd</span><span class="o">:</span><span class="nx">BitmapData</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">debugBmd</span><span class="o">:</span><span class="nx">BitmapData</span><span class="o">;</span>

    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">canvas</span><span class="o">:</span><span class="nx">Sprite</span><span class="o">;</span>

    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">score</span><span class="o">:</span><span class="nx">uint</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">scoreMax</span><span class="o">:</span><span class="nx">uint</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">mutations</span><span class="o">:</span><span class="nx">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">candidates</span><span class="o">:</span><span class="nx">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">totalTime</span><span class="o">:</span><span class="nx">Number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">time</span><span class="o">:</span><span class="nx">Date</span><span class="o">;</span>
    <span class="kr">private</span> <span class="kd">var</span> <span class="nx">scoreText</span><span class="o">:</span><span class="nx">TextField</span><span class="o">;</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">Evolve</span><span class="p">(){</span>
        <span class="nx">stage</span><span class="p">.</span><span class="nx">scaleMode</span> <span class="o">=</span> <span class="s2">"noScale"</span><span class="o">;</span>
        <span class="nx">stage</span><span class="p">.</span><span class="nx">align</span> <span class="o">=</span> <span class="s2">"TL"</span><span class="o">;</span>

        <span class="c1">// init image
</span>
        <span class="kd">var</span> <span class="nx">bmp</span><span class="o">:</span><span class="nx">Bitmap</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MonaLisa</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">inputBmd</span> <span class="o">=</span> <span class="nx">bmp</span><span class="p">.</span><span class="nx">bitmapData</span><span class="o">;</span>
        <span class="nx">addChild</span><span class="p">(</span><span class="nx">bmp</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">imgWidth</span> <span class="o">=</span> <span class="nx">bmp</span><span class="p">.</span><span class="nx">width</span><span class="o">;</span>
        <span class="nx">imgHeight</span> <span class="o">=</span> <span class="nx">bmp</span><span class="p">.</span><span class="nx">height</span><span class="o">;</span>
        <span class="nx">rect</span> <span class="o">=</span> <span class="nx">inputBmd</span><span class="p">.</span><span class="nx">rect</span><span class="o">;</span>
        <span class="nx">score</span> <span class="o">=</span> <span class="nx">scoreMax</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="mi">255</span><span class="o">;</span>

        <span class="c1">// init buffer
</span>
        <span class="nx">bestBmd</span> <span class="o">=</span> <span class="nx">inputBmd</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span><span class="o">;</span> <span class="nx">bestBmd</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="mh">0x000000</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">testBmd</span> <span class="o">=</span> <span class="nx">inputBmd</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span><span class="o">;</span> <span class="nx">testBmd</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="mh">0x000000</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">debugBmd</span> <span class="o">=</span> <span class="nx">inputBmd</span><span class="p">.</span><span class="nx">clone</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">addChild</span><span class="p">(</span><span class="k">new</span> <span class="nx">Bitmap</span><span class="p">(</span><span class="nx">bestBmd</span><span class="p">)).</span><span class="nx">x</span> <span class="o">=</span> <span class="nx">bmp</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="mi">10</span><span class="o">;</span>

        <span class="c1">// init data and canvas
</span>
        <span class="nx">canvas</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sprite</span><span class="p">()</span><span class="o">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">POLYGONS</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">polygons</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Polygon</span><span class="p">()</span><span class="o">;</span>
            <span class="nx">canvas</span><span class="p">.</span><span class="nx">addChild</span><span class="p">(</span><span class="k">new</span> <span class="nx">Sprite</span><span class="p">())</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">drawTest</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">testToBest</span><span class="p">()</span><span class="o">;</span>

        <span class="c1">// init ui
</span>
        <span class="kd">var</span> <span class="nx">tf</span><span class="o">:</span><span class="nx">TextField</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TextField</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">tf</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="s2">"click to start"</span><span class="o">;</span>
        <span class="nx">tf</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">bmp</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="mi">10</span><span class="o">;</span>
        <span class="nx">tf</span><span class="p">.</span><span class="nx">scaleX</span> <span class="o">=</span> <span class="nx">tf</span><span class="p">.</span><span class="nx">scaleY</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
        <span class="nx">addChild</span><span class="p">(</span><span class="nx">tf</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">stage</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="o">:*</span><span class="p">)</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
            <span class="nx">mutating</span> <span class="o">=</span> <span class="o">!</span><span class="nx">mutating</span><span class="o">;</span>
            <span class="nx">time</span> <span class="o">=</span> <span class="p">(</span><span class="nx">mutating</span> <span class="p">?</span> <span class="k">new</span> <span class="nx">Date</span><span class="p">()</span> <span class="p">:</span> <span class="kc">null</span><span class="p">)</span><span class="o">;</span>
            <span class="nx">tf</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="p">(</span><span class="nx">mutating</span> <span class="p">?</span> <span class="s2">"Now Simulating..."</span> <span class="p">:</span> <span class="s2">"click to start"</span><span class="p">)</span><span class="o">;</span>
        <span class="p">})</span><span class="o">;</span>
        <span class="nx">scoreText</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">TextField</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">scoreText</span><span class="p">.</span><span class="nx">autoSize</span> <span class="o">=</span> <span class="s2">"left"</span><span class="o">;</span>
        <span class="nx">scoreText</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="nx">bmp</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="mi">60</span><span class="o">;</span>
        <span class="nx">scoreText</span><span class="p">.</span><span class="nx">scaleX</span> <span class="o">=</span> <span class="nx">scoreText</span><span class="p">.</span><span class="nx">scaleY</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
        <span class="nx">addChild</span><span class="p">(</span><span class="nx">scoreText</span><span class="p">)</span><span class="o">;</span>

        <span class="c1">// start timer
</span>
        <span class="nx">setInterval</span><span class="p">(</span><span class="nx">update</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">update</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">mutating</span><span class="p">)</span> <span class="k">return</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">t</span><span class="o">:</span><span class="nx">Date</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Date</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">totalTime</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="err">-</span> <span class="nx">time</span><span class="p">.</span><span class="nx">getTime</span><span class="p">())</span> <span class="o">/</span> <span class="mi">1000</span><span class="o">;</span>
        <span class="nx">time</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>

        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="nx">update1</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">scoreText</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">((</span><span class="mi">1</span> <span class="err">-</span> <span class="nx">score</span> <span class="o">/</span> <span class="nx">scoreMax</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
             <span class="o">+</span> <span class="s2">"%\n"</span> <span class="o">+</span> <span class="nx">mutations</span> <span class="o">+</span> <span class="s2">" / "</span> <span class="o">+</span> <span class="nx">candidates</span> <span class="o">+</span> <span class="s2">"\n"</span>
             <span class="o">+</span> <span class="p">(</span><span class="nx">int</span><span class="p">(</span><span class="nx">totalTime</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"s"</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">update1</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
        <span class="kd">var</span> <span class="nx">index</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">POLYGONS</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">backup</span><span class="o">:</span><span class="nx">Polygon</span> <span class="o">=</span> <span class="nx">polygons</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">clone</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">polygons</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">mutate</span><span class="p">()</span><span class="o">;</span>
        <span class="nx">drawTest</span><span class="p">()</span><span class="o">;</span>

        <span class="kd">var</span> <span class="nx">diffBmd</span><span class="o">:</span><span class="nx">BitmapData</span> <span class="o">=</span> <span class="nx">testBmd</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">inputBmd</span><span class="p">)</span> <span class="nx">as</span> <span class="nx">BitmapData</span><span class="o">;</span>
        <span class="nx">diffBmd</span><span class="p">.</span><span class="nx">applyFilter</span><span class="p">(</span><span class="nx">diffBmd</span><span class="p">,</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">pt0</span><span class="p">,</span> <span class="nx">monotoneFilter</span><span class="p">)</span><span class="o">;</span>
        <span class="kd">var</span> <span class="nx">testScore</span><span class="o">:</span><span class="nx">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mh">0x100</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">testScore</span> <span class="o">+=</span> <span class="nx">diffBmd</span><span class="p">.</span><span class="nx">threshold</span><span class="p">(</span><span class="nx">diffBmd</span><span class="p">,</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">pt0</span><span class="p">,</span> <span class="s2">"=="</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">*</span> <span class="nx">i</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">score</span> <span class="o">&gt;</span> <span class="nx">testScore</span><span class="p">){</span>
            <span class="nx">score</span> <span class="o">=</span> <span class="nx">testScore</span><span class="o">;</span>
            <span class="nx">testToBest</span><span class="p">()</span><span class="o">;</span>
            <span class="nx">mutations</span><span class="o">++;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nx">polygons</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">backup</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">candidates</span><span class="o">++;</span>
    <span class="p">}</span>

    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">drawTest</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span><span class="o">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">POLYGONS</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
            <span class="nx">polygons</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">draw</span><span class="p">(</span><span class="nx">canvas</span><span class="p">,</span> <span class="nx">imgWidth</span><span class="p">,</span> <span class="nx">imgHeight</span><span class="p">)</span><span class="o">;</span>
        <span class="p">}</span>

        <span class="nx">testBmd</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="nx">rect</span><span class="p">,</span> <span class="mh">0x000000</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">testBmd</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="nx">canvas</span><span class="p">)</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">testToBest</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
        <span class="nx">bestBmd</span><span class="p">.</span><span class="nx">copyPixels</span><span class="p">(</span><span class="nx">testBmd</span><span class="p">,</span> <span class="nx">rect</span><span class="p">,</span> <span class="nx">pt0</span><span class="p">)</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">display</span><span class="p">.</span><span class="o">*;</span>
<span class="kr">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">geom</span><span class="p">.</span><span class="o">*;</span>

<span class="kr">class</span> <span class="nx">Polygon</span><span class="p">{</span>
    <span class="kr">private</span> <span class="kr">const</span> <span class="nx">POINTS</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">6</span><span class="o">;</span>

    <span class="kr">public</span> <span class="kd">var</span> <span class="nx">points</span><span class="o">:</span><span class="nx">Array</span> <span class="o">=</span> <span class="p">[]</span><span class="o">;</span>
    <span class="kr">public</span> <span class="kd">var</span> <span class="nx">color</span><span class="o">:</span><span class="nx">uint</span><span class="o">;</span>
    <span class="kr">public</span> <span class="kd">var</span> <span class="nx">alpha</span><span class="o">:</span><span class="nx">Number</span><span class="o">;</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">Polygon</span><span class="p">(</span><span class="nx">polygon</span><span class="o">:</span><span class="nx">Polygon</span> <span class="o">=</span> <span class="kc">null</span><span class="p">){</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">POINTS</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">polygon</span> <span class="p">?</span> <span class="nx">polygon</span><span class="p">.</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">clone</span><span class="p">()</span> <span class="p">:</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">(),</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()))</span><span class="o">;</span>
        <span class="nx">color</span> <span class="o">=</span> <span class="p">(</span><span class="nx">polygon</span> <span class="p">?</span> <span class="nx">polygon</span><span class="p">.</span><span class="nx">color</span> <span class="p">:</span> <span class="mh">0xffffff</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">())</span><span class="o">;</span>
        <span class="nx">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="nx">polygon</span> <span class="p">?</span> <span class="nx">polygon</span><span class="p">.</span><span class="nx">alpha</span> <span class="p">:</span> <span class="p">.</span><span class="mi">1</span><span class="p">)</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">clone</span><span class="p">()</span><span class="o">:</span><span class="nx">Polygon</span><span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Polygon</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">mutate</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
        <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="p">?</span> <span class="nx">mutateColor</span><span class="p">()</span> <span class="p">:</span> <span class="nx">mutatePosition</span><span class="p">())</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">mutateColor</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
        <span class="k">switch</span><span class="p">(</span><span class="nx">int</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)){</span>
            <span class="k">case</span> <span class="mi">0</span><span class="o">:</span> <span class="nx">color</span> <span class="o">=</span> <span class="p">(</span><span class="nx">color</span> <span class="o">&amp;</span> <span class="mh">0x00ffff</span><span class="p">)</span> <span class="o">+</span> <span class="nx">int</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span> <span class="o">*</span> <span class="mh">0x010000</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="o">:</span> <span class="nx">color</span> <span class="o">=</span> <span class="p">(</span><span class="nx">color</span> <span class="o">&amp;</span> <span class="mh">0xff00ff</span><span class="p">)</span> <span class="o">+</span> <span class="nx">int</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span> <span class="o">*</span> <span class="mh">0x000100</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">2</span><span class="o">:</span> <span class="nx">color</span> <span class="o">=</span> <span class="p">(</span><span class="nx">color</span> <span class="o">&amp;</span> <span class="mh">0xffff00</span><span class="p">)</span> <span class="o">+</span> <span class="nx">int</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span> <span class="o">*</span> <span class="mh">0x000001</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
            <span class="k">case</span> <span class="mi">3</span><span class="o">:</span> <span class="nx">alpha</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kr">private</span> <span class="kd">function</span> <span class="nx">mutatePosition</span><span class="p">()</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
        <span class="kd">var</span> <span class="nx">p</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">POINTS</span><span class="o">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="nx">points</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">x</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">;</span>
        <span class="k">else</span>                   <span class="nx">points</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">y</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kr">public</span> <span class="kd">function</span> <span class="nx">draw</span><span class="p">(</span><span class="nx">canvas</span><span class="o">:</span><span class="nx">Sprite</span><span class="p">,</span> <span class="nx">w</span><span class="o">:</span><span class="nx">Number</span><span class="p">,</span> <span class="nx">h</span><span class="o">:</span><span class="nx">Number</span><span class="p">)</span><span class="o">:</span><span class="nb">void</span><span class="p">{</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginFill</span><span class="p">(</span><span class="nx">color</span><span class="p">,</span> <span class="nx">alpha</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">h</span><span class="p">)</span><span class="o">;</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">:</span><span class="nx">int</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">POINTS</span><span class="o">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
            <span class="nx">canvas</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">x</span> <span class="o">*</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">points</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">h</span><span class="p">)</span><span class="o">;</span>
        <span class="nx">canvas</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">endFill</span><span class="p">()</span><span class="o">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>


</div>

<footer>

<div id="post-ad">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle my_adslot_1"
     style="display:inline-block"
     data-ad-client="ca-pub-5030829344952718"
     data-ad-slot="4154719447"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<ins class="adsbygoogle my_adslot_2"
     style="display:inline-block"
     data-ad-client="ca-pub-5030829344952718"
     data-ad-slot="5631452649"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

</div>

<div class="share">

<div class="share">
	
	<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://tech.nitoyon.com/en/blog/2009/02/17/50-polygons-mona-lisa-in-as3/" data-lang="en" data-size="horizontal" data-text="50 polygons Mona Lisa in AS3 - TECH-NI Blog" data-related="nitoyon" data-dnt="true">Tweet</a>
	<div class="fb-like" data-href="http://tech.nitoyon.com/en/blog/2009/02/17/50-polygons-mona-lisa-in-as3/" data-send="false" data-layout="button_count" data-width="90" data-show-faces="false"></div>
</div>

</div>

<div class="entry-data">
<div class="post-date">17 Feb 2009 <span class="edit-history"><a href="https://github.com/nitoyon/tech.nitoyon.com/commits/master/_posts/en/2009-02-17-50-polygons-mona-lisa-in-as3.md">View history</a></span></div>

<div class="post-tags"><a href="/en/blog/tags/actionscript/">ActionScript</a></div>
</div>



<div id="pager">
	
	<div class="previous">
		<a href="/en/blog/2008/06/26/color-illusion-generator-released/" rel="previous"><b>&laquo;</b><span class="title">Color Illusion Generator released</span></a>
	</div>
	
	
	<div class="next">
		<a href="/en/blog/2009/03/25/processing-firecube-example-ported-to-actionscript-30/" rel="next"><span class="title">Processing &quot;FireCube&quot; example ported to ActionScript 3.0</span><b>&raquo;</b></a>
	</div>
	
</div>

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</footer>
</div><!--entry-->

</article>

</div>
</div>

<footer class="page-footer">
<h2>About</h2>
<div class="wrapped">
<div id="footer-right-column" class="column">
	<div id="profile">
		<h3>Profile</h3>

		<a href="/about.html" id="prof_pic"><img alt="Photo" src="/img/icon/pic.jpg"></a>
		<p>nitoyon</p>
		<p>I'm a programmer in Japan, Kyoto.</p>
		<p class="seemore"><a href="/en/about/">more</a></p>
	</div>

	
</div>

<div id="footer-left-column" class="column">
	<div id="recententries">
		<h3>Recent Entries</h3>
		<ul id="recententries_list">
			<li><img src="/images/loading.gif"><noscript>(JavaScript required)</noscript></li>
		</ul>
	</div>
</div>
</div><!--wrapped-->

<div class="wrapped">
	<div id="archive">
	<h3>Archive</h3>
	<ul id="archive_month_list">
		<li><img src="/images/loading.gif"><noscript>(JavaScript required)</noscript></li>
	</ul>
	</div>
</div><!-- wrapped -->

<div class="wrap copy">
&copy; nitoyon 2002-2014. All rights reserved.
</div>
</footer>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/en/posts.js"></script>
<script src="/javascripts/techni.js"></script>
<div id="fb-root"></div>
</body>
</html>